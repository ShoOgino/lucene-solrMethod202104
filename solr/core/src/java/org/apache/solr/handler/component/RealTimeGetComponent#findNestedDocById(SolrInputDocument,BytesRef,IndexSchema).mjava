  /** Traverse the doc looking for a doc with the specified ID. */
  private static SolrInputDocument findNestedDocById(SolrInputDocument iDoc, BytesRef idBytes, IndexSchema schema) {
    assert schema.printableUniqueKey(iDoc) != null : "need IDs";
    // traverse nested doc, looking for the node with the ID we are looking for
    SolrInputDocument[] found = new SolrInputDocument[1];
    String idStr = schema.printableUniqueKey(idBytes);
    BiConsumer<String, SolrInputDocument> finder = (label, childDoc) -> {
      if (found[0] == null && idStr.equals(schema.printableUniqueKey(childDoc))) {
        found[0] = childDoc;
      }
    };
    iDoc.visitSelfAndNestedDocs(finder);
    return found[0];
  }

