  /**
   * Given some node Properties, checks if non-null and a 'zkHost' is alread included.  If so, the Properties are
   * returned as is.  If not, then the returned value will be a new Properties, wrapping the original Properties, 
   * with the 'zkHost' value set based on the value of the corispond System property (if set)
   *
   * In theory we only need this logic once, ideally in SolrDispatchFilter, but we put it here to re-use 
   * redundently because of how much surface area our API has for various tests to poke at us.
   */
  public static Properties wrapAndSetZkHostFromSysPropIfNeeded(final Properties props) {
    if (null != props && ! StringUtils.isEmpty(props.getProperty(ZK_HOST))) {
      // nothing to do...
      return props;
    }
    // we always wrap if we might set a property -- never mutate the original props
    final Properties results = (null == props ? new Properties() : new Properties(props));
    final String sysprop = System.getProperty(ZK_HOST);
    if (! StringUtils.isEmpty(sysprop)) {
      results.setProperty(ZK_HOST, sysprop);
    }
    return results;
  }

