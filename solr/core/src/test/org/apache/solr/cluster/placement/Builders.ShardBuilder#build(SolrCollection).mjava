    public Shard build(SolrCollection collection) {
      ClusterAbstractionsForTest.ShardImpl shard = new ClusterAbstractionsForTest.ShardImpl(shardName, collection, Shard.ShardState.ACTIVE);

      final LinkedHashMap<String, Replica> replicas = new LinkedHashMap<>();
      Replica leader = null;

      for (ReplicaBuilder replicaBuilder : replicaBuilders) {
        Replica replica = replicaBuilder.build(shard);
        replicas.put(replica.getReplicaName(), replica);

        if (leaderReplicaBuilder == replicaBuilder) {
          leader = replica;
        }
      }

      shard.setReplicas(replicas, leader);
      return shard;
    }

