  @Override
  public SolrResourceLoader createCoreResourceLoader(CoreDescriptor cd) {
    try {
      // for back compat with cores that can create collections without the collections API
      if (!zkController.getZkClient().exists(ZkStateReader.COLLECTIONS_ZKNODE + "/" + cd.getCollectionName(), true)) {
        CreateCollectionCmd.createCollectionZkNode(zkController.getSolrCloudManager().getDistribStateManager(), cd.getCollectionName(), cd.getCloudDescriptor().getParams());
      }
    } catch (KeeperException e) {
      SolrException.log(log, null, e);
    } catch (InterruptedException e) {
      Thread.currentThread().interrupt();
      SolrException.log(log, null, e);
    }

    String configName;
    try {
      configName = zkController.getZkStateReader().readConfigName(cd.getCollectionName());
    } catch (KeeperException ex) {
      throw new ZooKeeperException(SolrException.ErrorCode.SERVER_ERROR, "Specified config does not exist in ZooKeeper: " + cd.getCollectionName());
    }
    return new ZkSolrResourceLoader(cd.getInstanceDir(), configName, parentLoader.getClassLoader(),
        cd.getSubstitutableProperties(), zkController);
  }

