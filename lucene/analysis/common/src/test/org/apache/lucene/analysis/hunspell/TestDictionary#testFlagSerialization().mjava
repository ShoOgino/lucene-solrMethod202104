  @Test
  public void testFlagSerialization() {
    Random r = random();
    char[] flags = new char[r.nextInt(10)];
    for (int i = 0; i < flags.length; i++) {
      flags[i] = (char) r.nextInt(Character.MIN_SURROGATE);
    }

    String[] flagLines = {"FLAG long", "FLAG UTF-8", "FLAG num"};
    Charset[] charsets = {StandardCharsets.UTF_8, Dictionary.DEFAULT_CHARSET};
    for (String flagLine : flagLines) {
      for (Charset charset : charsets) {
        Dictionary.FlagParsingStrategy strategy =
            Dictionary.getFlagParsingStrategy(flagLine, charset);
        StringBuilder serialized = new StringBuilder();
        for (char flag : flags) {
          strategy.appendFlag(flag, serialized);
        }

        char[] deserialized = strategy.parseFlags(serialized.toString());
        assertEquals(new String(flags), new String(deserialized));
      }
    }
  }

