  @Test
  public void testCollect() throws Exception {
    String name = "solr-exporter-config.xml";
    SolrResourceLoader loader = new SolrResourceLoader(getFile("conf/").toPath());
    XmlConfigFile config = new XmlConfigFile(loader, name);

    CloudSolrClient cloudSolrClient = cluster.getSolrClient();

    SolrCollector collector = new SolrCollector(cloudSolrClient, config, 1);

    this.registry.register(collector);
    this.registry.register(SolrExporter.scrapeErrorTotal);

    // index sample docs
    File exampleDocsDir = new File(getFile("exampledocs").getAbsolutePath());
    List<File> xmlFiles = Arrays.asList(exampleDocsDir.listFiles((dir, file) -> file.endsWith(".xml")));
    for (File xml : xmlFiles) {
      ContentStreamUpdateRequest req = new ContentStreamUpdateRequest("/update");
      req.addFile(xml, "application/xml");
      cloudSolrClient.request(req, "collection1");
    }
    cloudSolrClient.commit("collection1");

    // collect metrics
    collector.collect();

    // check scrape error count
    assertEquals(0.0, registry.getSampleValue("solr_exporter_scrape_error_total", new String[]{}, new String[]{}), .001);
  }

