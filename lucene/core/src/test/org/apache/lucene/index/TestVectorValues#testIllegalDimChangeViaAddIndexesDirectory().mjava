  public void testIllegalDimChangeViaAddIndexesDirectory() throws Exception {
    try (Directory dir = newDirectory();
        Directory dir2 = newDirectory()) {
      try (IndexWriter w = new IndexWriter(dir, createIndexWriterConfig())) {
        Document doc = new Document();
        doc.add(new VectorField("f", new float[4], SearchStrategy.DOT_PRODUCT_HNSW));
        w.addDocument(doc);
      }
      try (IndexWriter w2 = new IndexWriter(dir2, createIndexWriterConfig())) {
        Document doc = new Document();
        doc.add(new VectorField("f", new float[5], VectorValues.SearchStrategy.DOT_PRODUCT_HNSW));
        w2.addDocument(doc);
        IllegalArgumentException expected =
            expectThrows(
                IllegalArgumentException.class, () -> w2.addIndexes(new Directory[] {dir}));
        assertEquals(
            "cannot change vector dimension from 5 to 4 for field=\"f\"", expected.getMessage());
      }
    }
  }

