        private void assertFolderAreSame(URI uri1, URI uri2) throws IOException {
            String[] files1 = repository.listAll(uri1);
            String[] files2 = repository.listAll(uri2);
            Arrays.sort(files1);
            Arrays.sort(files2);

            try {
                assertArrayEquals(files1, files2);
            } catch (AssertionError e) {
                e.printStackTrace();
            }

            for (int i = 0; i < files1.length; i++) {
                URI file1Uri = repository.resolve(uri1, files1[i]);
                URI file2Uri = repository.resolve(uri2, files2[i]);
                assertEquals(repository.getPathType(file1Uri), repository.getPathType(file2Uri));
                if (repository.getPathType(file1Uri) == BackupRepository.PathType.DIRECTORY) {
                    assertFolderAreSame(file1Uri, file2Uri);
                } else {
                    try (IndexInput in1 = repository.openInput(uri1, files1[i], IOContext.READONCE);
                         IndexInput in2 = repository.openInput(uri1, files1[i], IOContext.READONCE)) {
                        assertIndexInputEquals(in1, in2);
                    }
                }
            }
        }

