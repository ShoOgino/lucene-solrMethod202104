  /** test that we don't throw exception on multi-valued field (LUCENE-2142) */
  public void testMultiValuedField() throws IOException {
    Directory indexStore = newDirectory();
    IndexWriter writer = new IndexWriter(indexStore, newIndexWriterConfig(
        TEST_VERSION_CURRENT, new MockAnalyzer(random())));
    for(int i=0; i<5; i++) {
        Document doc = new Document();
        doc.add(new StringField("string", "a"+i, Field.Store.NO));
        doc.add(new StringField("string", "b"+i, Field.Store.NO));
        writer.addDocument(doc);
    }
    writer.forceMerge(1); // enforce one segment to have a higher unique term count in all cases
    writer.shutdown();
    Sort sort = new Sort(
        new SortField("string", SortField.Type.STRING),
        SortField.FIELD_DOC);
    // this should not throw AIOOBE or RuntimeEx
    IndexReader reader = UninvertingReader.wrap(DirectoryReader.open(indexStore),
                         Collections.singletonMap("string", Type.SORTED));
    // NOTE: we can't wrap this with newSearcher, because when the API is abused in this way,
    // the number of ords can exceed the number of documents, and AssertingAtomicReader will get angry,
    // rightfully so (its a broken dv)
    IndexSearcher searcher = new IndexSearcher(reader);
    searcher.search(new MatchAllDocsQuery(), null, 500, sort);
    reader.close();
    indexStore.close();
  }

