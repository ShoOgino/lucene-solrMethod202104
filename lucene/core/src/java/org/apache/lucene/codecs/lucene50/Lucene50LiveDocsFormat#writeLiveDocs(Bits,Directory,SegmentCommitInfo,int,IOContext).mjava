  @Override
  public void writeLiveDocs(Bits bits, Directory dir, SegmentCommitInfo info, int newDelCount, IOContext context) throws IOException {
    long gen = info.getNextDelGen();
    String name = IndexFileNames.fileNameFromGeneration(info.info.name, EXTENSION, gen);
    int delCount;
    try (IndexOutput output = dir.createOutput(name, context)) {
      
      CodecUtil.writeIndexHeader(output, CODEC_NAME, VERSION_CURRENT, info.info.getId(), Long.toString(gen, Character.MAX_RADIX));
      
      delCount = writeBits(output, bits);
      
      CodecUtil.writeFooter(output);
    }
    if (delCount != info.getDelCount() + newDelCount) {
      throw new CorruptIndexException("bits.deleted=" + delCount + 
          " info.delcount=" + info.getDelCount() + " newdelcount=" + newDelCount, name);
    }
  }

