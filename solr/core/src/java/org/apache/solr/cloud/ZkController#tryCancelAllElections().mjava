  /**
   * Attempts to cancel all leader elections. This method should be called on node shutdown.
   */
  public void tryCancelAllElections() {
    if (zkClient.isClosed()) {
      return;
    }
    Collection<ElectionContext> values = electionContexts.values();
    synchronized (electionContexts) {
      values.forEach(context -> {
        try {
          context.cancelElection();
          context.close();
        } catch (InterruptedException e) {
          Thread.currentThread().interrupt();
        } catch (KeeperException e) {
          log.warn("Error on cancelling elections of {}", context.leaderPath, e);
        }
      });
    }
  }

