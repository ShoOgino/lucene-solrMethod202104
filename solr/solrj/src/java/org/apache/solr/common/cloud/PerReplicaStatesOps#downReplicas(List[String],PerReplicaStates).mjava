    /**
     * mark a bunch of replicas as DOWN
     */
    public static PerReplicaStatesOps downReplicas(List<String> replicas, PerReplicaStates rs) {
        return new PerReplicaStatesOps(prs -> {
            List<PerReplicaStates.Operation> operations = new ArrayList<>();
            for (String replica : replicas) {
                PerReplicaStates.State r = rs.get(replica);
                if (r != null) {
                    if (r.state == Replica.State.DOWN && !r.isLeader) continue;
                    operations.add(new PerReplicaStates.Operation(PerReplicaStates.Operation.Type.ADD, new PerReplicaStates.State(replica, Replica.State.DOWN, Boolean.FALSE, r.version + 1)));
                    addDeleteStaleNodes(operations, r);
                } else {
                    operations.add(new PerReplicaStates.Operation(PerReplicaStates.Operation.Type.ADD, new PerReplicaStates.State(replica, Replica.State.DOWN, Boolean.FALSE, 0)));
                }
            }
            if (log.isDebugEnabled()) {
                log.debug("for coll: {} down replicas {}, ops {}", rs, replicas, operations);
            }
            return operations;
        }).init(rs);
    }

