  int add(char[] chars) {
    Arrays.sort(chars);
    String key = new String(chars);
    if (key.length() > Character.MAX_VALUE) {
      throw new IllegalArgumentException("Too many flags: " + key);
    }

    Integer existing = indices.get(key);
    if (existing != null) {
      return existing;
    }

    int result = builder.length();
    indices.put(key, result);
    builder.append((char) key.length());
    builder.append(key);
    return result;
  }

