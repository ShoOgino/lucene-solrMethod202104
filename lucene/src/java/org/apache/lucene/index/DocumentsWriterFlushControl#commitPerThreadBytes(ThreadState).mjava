  private void commitPerThreadBytes(ThreadState perThread) {
    final long delta = perThread.perThread.bytesUsed()
        - perThread.perThreadBytes;
    perThread.perThreadBytes += delta;
    /*
     * We need to differentiate here if we are pending since setFlushPending
     * moves the perThread memory to the flushBytes and we could be set to
     * pending during a delete
     */
    if (perThread.flushPending) {
      flushBytes += delta;
    } else {
      activeBytes += delta;
    }
    assert updatePeaks(delta);
  }

