  private int[][] getIndexedGraph(float[][] values, int mergePoint, long seed) throws IOException {
    HnswGraphBuilder.randSeed = seed;
    int[][] graph;
    try (Directory dir = newDirectory()) {
      IndexWriterConfig iwc = newIndexWriterConfig();
      iwc.setMergePolicy(new LogDocMergePolicy()); // for predictable segment ordering when merging
      iwc.setCodec(Codec.forName("Lucene90")); // don't use SimpleTextCodec
      try (IndexWriter iw = new IndexWriter(dir, iwc)) {
        for (int i = 0; i < values.length; i++) {
          add(iw, i, values[i]);
          if (i == mergePoint) {
            // flush proactively to create a segment
            iw.flush();
          }
        }
        iw.forceMerge(1);
      }
      try (IndexReader reader = DirectoryReader.open(dir)) {
        Lucene90VectorReader vectorReader =
            ((Lucene90VectorReader) ((CodecReader) getOnlyLeafReader(reader)).getVectorReader());
        graph = copyGraph(vectorReader.getGraphValues(KNN_GRAPH_FIELD));
      }
    }
    return graph;
  }

