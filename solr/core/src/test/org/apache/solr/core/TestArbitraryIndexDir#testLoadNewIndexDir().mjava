  @Test
  public void testLoadNewIndexDir() throws IOException, ParserConfigurationException, SAXException {
    //add a doc in original index dir
    assertU(adoc("id", String.valueOf(1),
        "name", "name"+String.valueOf(1)));
    //create a new index dir and index.properties file
    File idxprops = new File(h.getCore().getDataDir() + SnapPuller.INDEX_PROPERTIES);
    Properties p = new Properties();
    File newDir = new File(h.getCore().getDataDir() + "index_temp");
    newDir.mkdirs();
    p.put("index", newDir.getName());
    Writer os = null;
    try {
      os = new OutputStreamWriter(new FileOutputStream(idxprops), StandardCharsets.UTF_8);
      p.store(os, "index properties");
    } catch (Exception e) {
      throw new SolrException(SolrException.ErrorCode.SERVER_ERROR,
          "Unable to write " + SnapPuller.INDEX_PROPERTIES, e);
    } finally {
      IOUtils.closeWhileHandlingException(os);
    }

    //add a doc in the new index dir
    Directory dir = newFSDirectory(newDir.toPath());
    IndexWriter iw = new IndexWriter(
        dir,
        new IndexWriterConfig(new StandardAnalyzer())
    );
    Document doc = new Document();
    doc.add(new TextField("id", "2", Field.Store.YES));
    doc.add(new TextField("name", "name2", Field.Store.YES));
    iw.addDocument(doc);
    iw.commit();
    iw.close();

    //commit will cause searcher to open with the new index dir
    assertU(commit());h.getCoreContainer().reload(h.getCore().getName());
    //new index dir contains just 1 doc.
    assertQ("return doc with id 2",
        req("id:2"),
        "*[count(//doc)=1]"
    );
    dir.close();
  }

