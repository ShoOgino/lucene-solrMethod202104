  /** Simulates a crash of OS or machine by overwriting
   *  unsycned files. */
  public synchronized void crash() throws IOException {
    crashed = true;
    openFiles = new HashMap();
    Iterator it = unSyncedFiles.iterator();
    unSyncedFiles = new HashSet();
    int count = 0;
    while(it.hasNext()) {
      String name = (String) it.next();
      RAMFile file = (RAMFile) fileMap.get(name);
      if (count % 3 == 0) {
        deleteFile(name, true);
      } else if (count % 3 == 1) {
        // Zero out file entirely
        final int numBuffers = file.numBuffers();
        for(int i=0;i<numBuffers;i++) {
          byte[] buffer = file.getBuffer(i);
          Arrays.fill(buffer, (byte) 0);
        }
      } else if (count % 3 == 2) {
        // Truncate the file:
        file.setLength(file.getLength()/2);
      }
      count++;
    }
  }

