  private static void checkSoftDeletes(
      String softDeletesField,
      SegmentCommitInfo info,
      SegmentReader reader,
      PrintStream infoStream,
      boolean failFast)
      throws IOException {
    if (infoStream != null) infoStream.print("    test: check soft deletes.....");
    try {
      int softDeletes =
          PendingSoftDeletes.countSoftDeletes(
              DocValuesFieldExistsQuery.getDocValuesDocIdSetIterator(softDeletesField, reader),
              reader.getLiveDocs());
      if (softDeletes != info.getSoftDelCount()) {
        throw new RuntimeException(
            "actual soft deletes: " + softDeletes + " but expected: " + info.getSoftDelCount());
      }
    } catch (Exception e) {
      if (failFast) {
        throw IOUtils.rethrowAlways(e);
      }
      msg(infoStream, "ERROR [" + String.valueOf(e.getMessage()) + "]");
      if (infoStream != null) {
        e.printStackTrace(infoStream);
      }
    }
  }

