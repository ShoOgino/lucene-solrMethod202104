    public void testMostlySet() throws IOException {
      Directory d = newDirectory();
      final int numBits = TestUtil.nextInt(random(), 30, 1000);
      for(int numClear=0;numClear<20;numClear++) {
        BitVector bv = new BitVector(numBits);
        bv.invertAll();
        int count = 0;
        while(count < numClear) {
          final int bit = random().nextInt(numBits);
          // Don't use getAndClear, so that count is recomputed
          if (bv.get(bit)) {
            bv.clear(bit);
            count++;
            assertEquals(numBits-count, bv.count());
          }
        }
      }

      d.close();
    }

