  ConvTable(TreeMap<String, String> mappings) {
    mod = Math.max(256, Integer.highestOneBit(mappings.size()) << 1);
    firstCharHashes = new FixedBitSet(mod);

    try {
      Outputs<CharsRef> outputs = CharSequenceOutputs.getSingleton();
      FSTCompiler<CharsRef> fstCompiler = new FSTCompiler<>(FST.INPUT_TYPE.BYTE2, outputs);
      IntsRefBuilder scratchInts = new IntsRefBuilder();
      for (Map.Entry<String, String> entry : mappings.entrySet()) {
        String key = entry.getKey();
        assert key.length() > 0;
        firstCharHashes.set(key.charAt(0) % mod);
        Util.toUTF16(key, scratchInts);
        fstCompiler.add(scratchInts.get(), new CharsRef(entry.getValue()));
      }

      fst = fstCompiler.compile();
    } catch (IOException bogus) {
      throw new RuntimeException(bogus);
    }
  }

