  @Test
  public void testTemplatesApplyDuringInit() throws Exception {
    MetricsConfiguration config = Helpers.loadConfiguration("conf/test-config-with-templates.xml");
    List<MetricsQuery> metrics = config.getMetricsConfiguration();
    List<JsonQuery> jsonQueries = metrics.get(0).getJsonQueries();
    final int expectedJqQueriesInConfig = 6;
    assertEquals(expectedJqQueriesInConfig, jsonQueries.size());
    // JsonQuery does not implement an equals so use the string expression with whitespace collapsed to a single space
    for (int q = 0; q < jsonQueries.size(); q += 2) {
      String expected = jsonQueries.get(q + 1).toString().replaceAll("\\s+", " ").trim();
      String actual = jsonQueries.get(q).toString().replaceAll("\\s+", " ").trim();
      assertEquals(expected, actual);
    }
  }

