  private VariableResolver getVariableResolver() {
    try {
      VariableResolver resolver = null;
      String epoch = propWriter.convertDateToString(EPOCH);
      if(dataImporter != null && dataImporter.getCore() != null
          && dataImporter.getCore().getCoreDescriptor().getSubstitutableProperties() != null){
        resolver =  new VariableResolver(dataImporter.getCore().getCoreDescriptor().getSubstitutableProperties());
      } else {
        resolver = new VariableResolver();
      }
      resolver.setEvaluators(dataImporter.getEvaluators());
      Map<String, Object> indexerNamespace = new HashMap<>();
      if (persistedProperties.get(LAST_INDEX_TIME) != null) {
        indexerNamespace.put(LAST_INDEX_TIME, persistedProperties.get(LAST_INDEX_TIME));
      } else  {
        // set epoch
        indexerNamespace.put(LAST_INDEX_TIME, epoch);
      }
      indexerNamespace.put(INDEX_START_TIME, dataImporter.getIndexStartTime());
      indexerNamespace.put("request", new HashMap<>(reqParams.getRawParams()));
      indexerNamespace.put("handlerName", dataImporter.getHandlerName());
      for (Entity entity : dataImporter.getConfig().getEntities()) {
        Map<String, Object> entityNamespace = new HashMap<>();
        String key = SolrWriter.LAST_INDEX_KEY;
        Object lastIndex = persistedProperties.get(entity.getName() + "." + key);
        if (lastIndex != null) {
          entityNamespace.put(SolrWriter.LAST_INDEX_KEY, lastIndex);
        } else  {
          entityNamespace.put(SolrWriter.LAST_INDEX_KEY, epoch);
        }
        indexerNamespace.put(entity.getName(), entityNamespace);
      }
      resolver.addNamespace(ConfigNameConstants.IMPORTER_NS_SHORT, indexerNamespace);
      resolver.addNamespace(ConfigNameConstants.IMPORTER_NS, indexerNamespace);
      return resolver;
    } catch (Exception e) {
      wrapAndThrow(SEVERE, e);
      // unreachable statement
      return null;
    }
  }

