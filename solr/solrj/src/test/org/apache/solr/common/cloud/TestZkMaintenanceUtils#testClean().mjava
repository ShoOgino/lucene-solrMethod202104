  /**
   * This test reproduces the issue of trying to delete zk-nodes that have the same length. (SOLR-14961).
   *
   * @throws InterruptedException when having trouble creating test nodes
   * @throws KeeperException error when talking to zookeeper
   * @throws SolrServerException when having trouble connecting to solr
   * @throws UnsupportedEncodingException when getBytes() uses unknown encoding
   *
   */
  @Test
  public void testClean() throws KeeperException, InterruptedException, SolrServerException, UnsupportedEncodingException {
    try(SolrZkClient zkClient = new SolrZkClient(zkServer.getZkHost(), 10000)){
      /* PREPARE */
      String path = "/myPath/isTheBest";
      String data1 = "myStringData1";
      String data2 = "myStringData2";
      String longData = "myLongStringData";
      // create zk nodes that have the same path length
      zkClient.create("/myPath", null, CreateMode.PERSISTENT, true);
      zkClient.create(path, null, CreateMode.PERSISTENT, true);
      zkClient.create(path +"/file1.txt", data1.getBytes(StandardCharsets.UTF_8), CreateMode.PERSISTENT, true);
      zkClient.create(path +"/nothing.txt", null, CreateMode.PERSISTENT, true);
      zkClient.create(path +"/file2.txt", data2.getBytes(StandardCharsets.UTF_8), CreateMode.PERSISTENT, true);
      zkClient.create(path +"/some_longer_file2.txt", longData.getBytes(StandardCharsets.UTF_8), CreateMode.PERSISTENT, true);

      /* RUN */
      // delete all nodes that contain "file"
      ZkMaintenanceUtils.clean(zkClient,path, node -> node.contains("file"));

      /* CHECK */
      String listZnode = zkClient.listZnode(path, false);
      // list of node must not contain file1, file2 or some_longer_file2 because they where deleted
      assertFalse(listZnode.contains("file1"));
      assertFalse(listZnode.contains("file2"));
      assertFalse(listZnode.contains("some_longer_file2"));
      assertTrue(listZnode.contains("nothing"));
    }
  }

