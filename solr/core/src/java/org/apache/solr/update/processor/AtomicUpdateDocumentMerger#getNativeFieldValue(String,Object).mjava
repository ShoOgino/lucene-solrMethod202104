  private Object getNativeFieldValue(String fieldName, Object val) {
    if (isChildDoc(val) || val == null || (val instanceof Collection && ((Collection) val).isEmpty())) {
      return val;
    }
    SchemaField sf = schema.getField(fieldName);
    try {
      return sf.getType().toNativeType(val);
    } catch (SolrException ex) {
      throw new SolrException(SolrException.ErrorCode.getErrorCode(ex.code()),
          "Error converting field '" + sf.getName() + "'='" +val+"' to native type, msg=" + ex.getMessage(), ex);
    } catch (Exception ex) {
      throw new SolrException( SolrException.ErrorCode.BAD_REQUEST,
          "Error converting field '" + sf.getName() + "'='" +val+"' to native type, msg=" + ex.getMessage(), ex);
    }
  }

