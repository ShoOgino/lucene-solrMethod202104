  /**
   * Entry point for clustering in local server mode (non-distributed).
   *
   * @param rb The {@link ResponseBuilder}.
   * @throws IOException Propagated if an I/O exception occurs.
   */
  @Override
  public void process(ResponseBuilder rb) throws IOException {
    if (!isComponentEnabled(rb)) {
      return;
    }

    EngineEntry engine = getEngine(rb);
    EngineParameters parameters = engine.defaults.derivedFrom(rb.req.getParams());

    List<InputDocument> inputs = getDocuments(rb, parameters);

    if (rb.req.getParams().getBool(ShardParams.IS_SHARD, false) &&
        rb.req.getParams().getBool(REQUEST_PARAM_COLLECT_INPUTS, false)) {
      rb.rsp.add(RESPONSE_SECTION_INPUT_DOCUMENTS, documentsToNamedList(inputs));
    } else {
      doCluster(rb, engine, inputs, parameters);
    }
  }

