  public void testTerms(
      final Fields fieldsSource,
      final EnumSet<Option> options,
      final IndexOptions maxTestOptions,
      final IndexOptions maxIndexOptions,
      final boolean alwaysTestMax)
      throws Exception {

    if (options.contains(Option.THREADS)) {
      int numThreads = LuceneTestCase.TEST_NIGHTLY ? TestUtil.nextInt(random, 2, 5) : 2;
      Thread[] threads = new Thread[numThreads];
      for (int threadUpto = 0; threadUpto < numThreads; threadUpto++) {
        threads[threadUpto] =
            new TestThread(
                new Random(random.nextLong()),
                this,
                fieldsSource,
                options,
                maxTestOptions,
                maxIndexOptions,
                alwaysTestMax);
        threads[threadUpto].start();
      }
      for (int threadUpto = 0; threadUpto < numThreads; threadUpto++) {
        threads[threadUpto].join();
      }
    } else {
      testTermsOneThread(
          random, fieldsSource, options, maxTestOptions, maxIndexOptions, alwaysTestMax);
    }
  }

