    @BeforeClass
    public static void setupClass() throws Exception {
        dfsCluster = HdfsTestUtil.setupClass(createTempDir().toFile().getAbsolutePath());
        hdfsUri = HdfsTestUtil.getURI(dfsCluster);
        try {
            URI uri = new URI(hdfsUri);
            Configuration conf = HdfsTestUtil.getClientConfiguration(dfsCluster);
            fs = FileSystem.get(uri, conf);

            if (fs instanceof DistributedFileSystem) {
                // Make sure dfs is not in safe mode
                while (((DistributedFileSystem) fs).setSafeMode(HdfsConstants.SafeModeAction.SAFEMODE_GET, true)) {
                    try {
                        Thread.sleep(5000);
                    } catch (InterruptedException e) {
                        Thread.interrupted();
                        // continue
                    }
                }
            }

            fs.mkdirs(new org.apache.hadoop.fs.Path("/backup"));
        } catch (IOException | URISyntaxException e) {
            throw new RuntimeException(e);
        }

        System.setProperty("solr.hdfs.default.backup.path", "/backup");
        System.setProperty("solr.hdfs.home", hdfsUri + "/solr");
        useFactory("solr.StandardDirectoryFactory");
    }

