  List<CharsRef> doStem(char[] word, int length, boolean caseVariant) {
    List<CharsRef> stems = new ArrayList<>();
    IntsRef forms = dictionary.lookupWord(word, 0, length);
    if (forms != null) {
      for (int i = 0; i < forms.length; i += formStep) {
        char[] wordFlags = dictionary.decodeFlags(forms.ints[forms.offset + i], scratch);
        if (!acceptCase(caseVariant, wordFlags)) {
          continue;
        }
        // we can't add this form, it's a pseudostem requiring an affix
        if (Dictionary.hasFlag(wordFlags, dictionary.needaffix)) {
          continue;
        }
        // we can't add this form, it only belongs inside a compound word
        if (Dictionary.hasFlag(wordFlags, dictionary.onlyincompound)) {
          continue;
        }
        stems.add(newStem(word, 0, length, forms, i));
      }
    }
    try {
      stems.addAll(
          stem(word, 0, length, -1, (char) 0, -1, 0, true, true, false, false, caseVariant));
    } catch (IOException bogus) {
      throw new RuntimeException(bogus);
    }
    return stems;
  }

