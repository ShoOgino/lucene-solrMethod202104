    @Override
    public void computeUpdates(ClusterState clusterState) {
      final DocCollection docCollection = clusterState.getCollectionOrNull(collectionName);
      Optional<ZkWriteCommand> result = docCollection != null ? NodeMutator.computeCollectionUpdate(nodeName, collectionName, docCollection) : Optional.empty();

      if (docCollection == null) {
        // This is possible but should be rare. Logging warn in case it is seen often and likely a sign of another issue
        log.warn("Processing DOWNNODE, collection " + collectionName + " disappeared during iteration"); // nowarn
      }

      if (result.isPresent()) {
        ZkWriteCommand zkcmd = result.get();
        computedState = (zkcmd != ZkStateWriter.NO_OP) ? clusterState.copyWith(zkcmd.name, zkcmd.collection) : null;
        replicaOpsList = (zkcmd.ops != null && zkcmd.ops.get() != null) ? Collections.singletonList(zkcmd.ops) : null;
      } else {
        computedState = null;
        replicaOpsList = null;
      }
    }

