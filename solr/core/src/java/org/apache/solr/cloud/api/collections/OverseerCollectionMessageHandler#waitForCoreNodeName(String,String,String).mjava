  String waitForCoreNodeName(String collectionName, String msgNodeName, String msgCore) {
    AtomicReference<String> coreNodeName = new AtomicReference<>();
    try {
      zkStateReader.waitForState(collectionName, 320, TimeUnit.SECONDS, c -> {
        String name = ClusterStateMutator.getAssignedCoreNodeName(c, msgNodeName, msgCore);
        if (name == null) {
          return false;
        }
        coreNodeName.set(name);
        return true;
      });
    } catch (TimeoutException | InterruptedException e) {
      SolrZkClient.checkInterrupted(e);
      throw new SolrException(ErrorCode.SERVER_ERROR, "Failed waiting for coreNodeName", e);
    }
    return coreNodeName.get();
  }

