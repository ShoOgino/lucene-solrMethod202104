  public OverseerCollectionMessageHandler(ZkStateReader zkStateReader, String myId,
                                        final HttpShardHandlerFactory shardHandlerFactory,
                                        String adminPath,
                                        Stats stats,
                                        Overseer overseer,
                                        OverseerNodePrioritizer overseerPrioritizer) {
    this.zkStateReader = zkStateReader;
    this.shardHandlerFactory = shardHandlerFactory;
    this.adminPath = adminPath;
    this.myId = myId;
    this.stats = stats;
    this.overseer = overseer;
    this.cloudManager = overseer.getSolrCloudManager();
    this.timeSource = cloudManager.getTimeSource();
    this.isClosed = false;
    ccc = new OcmhCollectionCommandContext(this);
    commandMap = new ImmutableMap.Builder<CollectionAction, CollApiCmds.CollectionApiCommand>()
        .put(REPLACENODE, new ReplaceNodeCmd(ccc))
        .put(DELETENODE, new DeleteNodeCmd(ccc))
        .put(BACKUP, new BackupCmd(ccc))
        .put(RESTORE, new RestoreCmd(ccc))
        .put(DELETEBACKUP, new DeleteBackupCmd(ccc))
        .put(CREATESNAPSHOT, new CreateSnapshotCmd(ccc))
        .put(DELETESNAPSHOT, new DeleteSnapshotCmd(ccc))
        .put(SPLITSHARD, new SplitShardCmd(ccc))
        .put(ADDROLE, new OverseerRoleCmd(ccc, ADDROLE, overseerPrioritizer))
        .put(REMOVEROLE, new OverseerRoleCmd(ccc, REMOVEROLE, overseerPrioritizer))
        .put(MOCK_COLL_TASK, new CollApiCmds.MockOperationCmd())
        .put(MOCK_SHARD_TASK, new CollApiCmds.MockOperationCmd())
        .put(MOCK_REPLICA_TASK, new CollApiCmds.MockOperationCmd())
        .put(CREATESHARD, new CreateShardCmd(ccc))
        .put(MIGRATE, new MigrateCmd(ccc))
        .put(CREATE, new CreateCollectionCmd(ccc))
        .put(MODIFYCOLLECTION, new CollApiCmds.ModifyCollectionCmd(ccc))
        .put(ADDREPLICAPROP, new CollApiCmds.AddReplicaPropCmd(ccc))
        .put(DELETEREPLICAPROP, new CollApiCmds.DeleteReplicaPropCmd(ccc))
        .put(BALANCESHARDUNIQUE, new CollApiCmds.BalanceShardsUniqueCmd(ccc))
        .put(REBALANCELEADERS, new CollApiCmds.RebalanceLeadersCmd(ccc))
        .put(RELOAD, new CollApiCmds.ReloadCollectionCmd(ccc))
        .put(DELETE, new DeleteCollectionCmd(ccc))
        .put(CREATEALIAS, new CreateAliasCmd(ccc))
        .put(DELETEALIAS, new DeleteAliasCmd(ccc))
        .put(ALIASPROP, new SetAliasPropCmd(ccc))
        .put(MAINTAINROUTEDALIAS, new MaintainRoutedAliasCmd(ccc))
        .put(OVERSEERSTATUS, new OverseerStatusCmd(ccc))
        .put(DELETESHARD, new DeleteShardCmd(ccc))
        .put(DELETEREPLICA, new DeleteReplicaCmd(ccc))
        .put(ADDREPLICA, new AddReplicaCmd(ccc))
        .put(MOVEREPLICA, new MoveReplicaCmd(ccc))
        .put(REINDEXCOLLECTION, new ReindexCollectionCmd(ccc))
        .put(RENAME, new RenameCmd(ccc))
        .build()
    ;
  }

