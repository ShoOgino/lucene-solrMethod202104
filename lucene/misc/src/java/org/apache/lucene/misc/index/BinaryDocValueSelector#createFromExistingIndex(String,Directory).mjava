  public static List<IndexRearranger.DocumentSelector> createFromExistingIndex(
      String field, Directory directory) throws IOException {
    List<IndexRearranger.DocumentSelector> selectors = new ArrayList<>();
    try (IndexReader reader = DirectoryReader.open(directory)) {
      for (LeafReaderContext context : reader.leaves()) {
        HashSet<String> keySet = new HashSet<>();
        Bits liveDocs = context.reader().getLiveDocs();
        BinaryDocValues binaryDocValues = context.reader().getBinaryDocValues(field);
        for (int i = 0; i < context.reader().maxDoc(); i++) {
          if (liveDocs != null && liveDocs.get(i) == false) {
            continue;
          }
          if (binaryDocValues.advanceExact(i)) {
            keySet.add(binaryDocValues.binaryValue().utf8ToString());
          } else {
            throw new AssertionError("Document don't have selected key");
          }
        }
        selectors.add(new BinaryDocValueSelector(field, keySet));
      }
    }
    return selectors;
  }

