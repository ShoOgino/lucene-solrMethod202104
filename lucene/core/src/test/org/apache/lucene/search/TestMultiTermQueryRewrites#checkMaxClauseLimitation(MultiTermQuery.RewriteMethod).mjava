  private void checkMaxClauseLimitation(MultiTermQuery.RewriteMethod method) throws Exception {
    int savedMaxClauseCount = BooleanQuery.getMaxClauseCount();
    BooleanQuery.setMaxClauseCount(3);
    
    final MultiTermQuery mtq = TermRangeQuery.newStringRange("data", "2", "7", true, true);
    mtq.setRewriteMethod(method);
    try {
      BooleanQuery.TooManyClauses expected = expectThrows(BooleanQuery.TooManyClauses.class, () -> {
        multiSearcherDupls.rewrite(mtq);
      });
      //  Maybe remove this assert in later versions, when internal API changes:
      assertEquals("Should throw BooleanQuery.TooManyClauses with a stacktrace containing checkMaxClauseCount()",
        "checkMaxClauseCount", expected.getStackTrace()[0].getMethodName());
    } finally {
      BooleanQuery.setMaxClauseCount(savedMaxClauseCount);
    }
  }

