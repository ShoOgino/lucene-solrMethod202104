  @Test
  public void testCreateCollectionCleanup() throws Exception {
    final CloudSolrClient cloudClient = cluster.getSolrClient();
    // Create a collection that would fail
    CollectionAdminRequest.Create create = CollectionAdminRequest.createCollection("foo","conf1",1,1);

    Properties properties = new Properties();
    properties.put(CoreAdminParams.DATA_DIR, "/some_invalid_dir/foo");
    create.setProperties(properties);
    CollectionAdminResponse rsp = create.process(cloudClient);
    assertFalse(rsp.isSuccess());

    // Confirm using LIST that the collection does not exist
    CollectionAdminRequest.List list = CollectionAdminRequest.listCollections();
    rsp = list.process(cloudClient);
    assertFalse(((ArrayList) rsp.getResponse().get("collections")).contains("foo"));
  }

