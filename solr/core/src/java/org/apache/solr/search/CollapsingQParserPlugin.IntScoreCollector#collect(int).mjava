    @Override
    public void collect(int contextDoc) throws IOException {
      final int globalDoc = docBase+contextDoc;
      if (collapseValues.advanceExact(contextDoc)) {
        final int collapseValue = (int) collapseValues.longValue();
        // Check to see if we have documents boosted by the QueryElevationComponent (skip normal strategy based collection)
        if (boostedDocsCollector.collectIfBoosted(collapseValue, globalDoc)) return;

        float score = scorer.score();
        final int idx;
        if((idx = cmap.indexOf(collapseValue)) >= 0) {
          long scoreDoc = cmap.indexGet(idx);
          int testScore = (int)(scoreDoc>>32);
          int currentScore = Float.floatToRawIntBits(score);
          if(currentScore > testScore) {
            //Current score is higher so replace the old scoreDoc with the current scoreDoc
            cmap.indexReplace(idx, (((long)currentScore)<<32)+globalDoc);
          }
        } else {
          //Combine the score and document into a long.
          long scoreDoc = (((long)Float.floatToRawIntBits(score))<<32)+globalDoc;
          cmap.indexInsert(idx, collapseValue, scoreDoc);
        }

      } else { // Null Group...
        
        // Check to see if we have documents boosted by the QueryElevationComponent (skip normal strategy based collection)
        if (boostedDocsCollector.collectInNullGroupIfBoosted(globalDoc)) return;

        if(nullPolicy == NullPolicy.COLLAPSE.getCode()) {
          float score = scorer.score();
          if(score > this.nullScore) {
            this.nullScore = score;
            this.nullDoc = globalDoc;
          }
        } else if(nullPolicy == NullPolicy.EXPAND.getCode()) {
          collapsedSet.set(globalDoc);
          nullScores.add(scorer.score());
        }
      }

    }

