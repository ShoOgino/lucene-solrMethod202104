  public static long getTotalTermFreq(IndexReader reader, String field, BytesRef termText) throws Exception {

    long totalTF = 0;
    
    Terms terms = MultiFields.getTerms(reader, field);
    if (terms == null) {
      return 0;
    }

    TermsEnum termsEnum = terms.iterator();
    if (termsEnum.seek(termText) != TermsEnum.SeekStatus.FOUND) {
      return 0;
    }

    Bits skipDocs = MultiFields.getDeletedDocs(reader);
    if (skipDocs == null) {
      // TODO: we could do this up front, during the scan
      // (next()), instead of after-the-fact here w/ seek,
      // if the codec supports it and there are no del
      // docs...
      final long totTF = termsEnum.totalTermFreq();
      if (totTF != -1) {
        return totTF;
      }
    }
    
    DocsEnum de = termsEnum.docs(skipDocs, null);

    // use DocsEnum.read() and BulkResult api
    final DocsEnum.BulkReadResult bulkresult = de.getBulkResult();
    int count;
    while ((count = de.read()) != 0) {
      final int[] freqs = bulkresult.freqs.ints;
      final int limit = bulkresult.freqs.offset + count;
      for(int i=bulkresult.freqs.offset;i<limit;i++) {
        totalTF += freqs[i];
      }
    }
    return totalTF;
  }

