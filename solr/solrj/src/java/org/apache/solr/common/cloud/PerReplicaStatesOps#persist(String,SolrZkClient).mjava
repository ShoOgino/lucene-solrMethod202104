    /**
     * This is a persist operation with retry if a write fails due to stale state
     */
    public void persist(String znode, SolrZkClient zkClient) throws KeeperException, InterruptedException {
        List<PerReplicaStates.Operation> operations = ops;
        for (int i = 0; i < PerReplicaStates.MAX_RETRIES; i++) {
            try {
                persist(operations, znode, zkClient);
                return;
            } catch (KeeperException.NodeExistsException | KeeperException.NoNodeException e) {
                // state is stale
                if(log.isInfoEnabled()) {
                    log.info("Stale state for {}, attempt: {}. retrying...", znode, i);
                }
                operations = refresh(PerReplicaStates.fetch(znode, zkClient, null));
            }
        }
    }

