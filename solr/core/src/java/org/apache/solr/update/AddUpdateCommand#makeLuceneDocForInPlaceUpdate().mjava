  /**
   * Creates and returns a lucene Document for in-place update.
   * The SolrInputDocument itself may be modified, which will be reflected in the update log.
   * Any changes made to the returned Document will not be reflected in the SolrInputDocument, or future calls to this
   * method.
   */
   Document makeLuceneDocForInPlaceUpdate() {
     // perhaps this should move to UpdateHandler or DocumentBuilder?
     assert isInPlaceUpdate();
     if (req.getSchema().isUsableForChildDocs() && solrDoc.getField(IndexSchema.ROOT_FIELD_NAME) == null) {
       solrDoc.setField(IndexSchema.ROOT_FIELD_NAME, getIndexedIdStr());
     }
     final boolean forInPlaceUpdate = true;
     final boolean ignoreNestedDocs = false; // throw an exception if found
     return DocumentBuilder.toDocument(solrDoc, req.getSchema(), forInPlaceUpdate, ignoreNestedDocs);
   }

