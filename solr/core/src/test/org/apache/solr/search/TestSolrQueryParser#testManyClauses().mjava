  @Test
  public void testManyClauses() throws Exception {
    String a = "1 a 2 b 3 c 10 d 11 12 "; // 10 terms
    StringBuilder sb = new StringBuilder("id:(");
    for (int i = 0; i < 1024; i++) { // historically, the max number of boolean clauses defaulted to 1024
      sb.append('z').append(i).append(' ');
    }
    sb.append(a);
    sb.append(")");

    String q = sb.toString();

    // This will still fail when used as the main query, but will pass in a filter query since TermsQuery can be used.
    {
      ignoreException("Too many clauses");
      SolrException e = expectThrows(SolrException.class, "exoected too many clauses exception",
          () -> assertJQ(req("q", q), "/response/numFound==6"));
      assertTrue(e.getMessage().contains("many clauses"));
    }

    assertJQ(req("q","*:*", "fq", q)
        ,"/response/numFound==6");
    assertJQ(req("q","*:*", "fq", q, "sow", "false")
        ,"/response/numFound==6");
    assertJQ(req("q","*:*", "fq", q, "sow", "true")
        ,"/response/numFound==6");
  }

