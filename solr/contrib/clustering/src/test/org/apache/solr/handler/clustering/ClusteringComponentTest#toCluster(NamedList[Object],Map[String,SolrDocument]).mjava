  @SuppressWarnings("unchecked")
  private Cluster<SolrDocument> toCluster(NamedList<Object> v, Map<String, SolrDocument> idToDoc) {
    Cluster<SolrDocument> c = new Cluster<>();
    v.forEach((key, value) -> {
      switch (key) {
        case ClusteringResponse.DOCS_NODE:
          ((List<String>) value).forEach(docId -> c.addDocument(idToDoc.get(docId)));
          break;
        case ClusteringResponse.LABELS_NODE:
          ((List<String>) value).forEach(c::addLabel);
          break;
        case ClusteringResponse.SCORE_NODE:
          c.setScore(((Number) value).doubleValue());
          break;
        case ClusteringResponse.CLUSTERS_NODE:
          ((List<NamedList<Object>>) value).forEach(sub -> {
            c.addCluster(toCluster(sub, idToDoc));
          });
          break;
        case ClusteringResponse.IS_OTHER_TOPICS:
          // Just ignore the attribute.
          break;
        default:
          throw new RuntimeException("Unknown output property " + key + " in cluster: " + v.jsonStr());
      }
    });
    return c;
  }

