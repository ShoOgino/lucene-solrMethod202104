  public void testSolrHomeAndResourceLoaders() throws Exception {
    final String SOLR_HOME_PROP = "solr.solr.home";
    // regardless of what sys prop may be set, everything in the cluster should use solr home dirs under the 
    // configured base dir -- and nothing in the call stack should be "setting" the sys prop to make that work...
    final String fakeSolrHome = createTempDir().toAbsolutePath().toString();
    System.setProperty(SOLR_HOME_PROP, fakeSolrHome);

    // mock FS from createTempDir don't play nice using 'startsWith' when the solr stack reconsistutes the path from string
    // so we have to go the string route here as well...
    final Path workDir = Paths.get(createTempDir().toAbsolutePath().toString());
    
    final MiniSolrCloudCluster cluster = new MiniSolrCloudCluster(1, workDir, JettyConfig.builder().build());
    try {
      final JettySolrRunner jetty = cluster.getJettySolrRunners().get(0);
      assertTrue(jetty.getCoreContainer().getSolrHome() + " vs " + workDir,
                 // mock dirs from createTempDir() don't play nice with startsWith, so we have to use the string value
                 Paths.get(jetty.getCoreContainer().getSolrHome()).startsWith(workDir));
      assertEquals(jetty.getCoreContainer().getSolrHome(),
                   jetty.getCoreContainer().getResourceLoader().getInstancePath().toAbsolutePath().toString());

      assertTrue(CollectionAdminRequest.createCollection("test", 1,1).process(cluster.getSolrClient()).isSuccess());
      final SolrCore core = jetty.getCoreContainer().getCores().get(0);
      assertTrue(core.getInstancePath() + " vs " + workDir,
                 core.getInstancePath().startsWith(workDir));
      assertEquals(core.getInstancePath(),
                   core.getResourceLoader().getInstancePath());
    } finally {
      cluster.shutdown();
    }
    assertEquals("There is no reason why anything should have set this sysprop",
                 fakeSolrHome, System.getProperty(SOLR_HOME_PROP));
  }

