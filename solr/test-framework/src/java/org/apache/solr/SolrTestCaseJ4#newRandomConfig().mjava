  /** sets system properties based on 
   * {@link #newIndexWriterConfig(org.apache.lucene.analysis.Analyzer)}
   * 
   * configs can use these system properties to vary the indexwriter settings
   */
  public static void newRandomConfig() {
    IndexWriterConfig iwc = newIndexWriterConfig(new MockAnalyzer(random()));

    System.setProperty("useCompoundFile", String.valueOf(iwc.getUseCompoundFile()));

    System.setProperty("solr.tests.maxBufferedDocs", String.valueOf(iwc.getMaxBufferedDocs()));
    System.setProperty("solr.tests.ramBufferSizeMB", String.valueOf(iwc.getRAMBufferSizeMB()));
    System.setProperty("solr.tests.mergeScheduler", iwc.getMergeScheduler().getClass().getName());

    // don't ask iwc.getMaxThreadStates(), sometimes newIWC uses 
    // RandomDocumentsWriterPerThreadPool and all hell breaks loose
    int maxIndexingThreads = rarely(random())
      ? TestUtil.nextInt(random(), 5, 20) // crazy value
      : TestUtil.nextInt(random(), 1, 4); // reasonable value
    System.setProperty("solr.tests.maxIndexingThreads", String.valueOf(maxIndexingThreads));
  }

