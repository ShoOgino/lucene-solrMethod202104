  /**
   * Merges the fromDoc into the toDoc using the atomic update syntax.
   * This method will look for a nested document (possibly {@code toDoc} itself) with an
   * equal ID, and merge into that one.
   * @param sdoc the doc containing update instructions
   * @param toDoc the target doc (possibly nested) before the update (will be modified in-place)
   * @return toDoc with modifications; never null
   */
  public SolrInputDocument merge(SolrInputDocument sdoc, SolrInputDocument toDoc) {
    if (mergeChildDocRecursive(sdoc, getRequiredId(sdoc), toDoc)) {
      return toDoc;
    }
    throw new IllegalStateException("Did not find child ID " + getRequiredId(sdoc) +
        " in parent ID " + getRequiredId(toDoc));
  }

