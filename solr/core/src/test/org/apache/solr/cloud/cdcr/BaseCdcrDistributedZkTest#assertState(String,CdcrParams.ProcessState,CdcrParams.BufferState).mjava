  /**
   * Assert the state of CDCR on each nodes of the given collection.
   */
  protected void assertState(String collection, CdcrParams.ProcessState processState, CdcrParams.BufferState bufferState)
  throws Exception {
    this.waitForCdcrStateReplication(collection); // ensure that cdcr state is replicated and stable
    for (CloudJettyRunner jetty : cloudJettys.get(collection)) { // check all replicas
      @SuppressWarnings({"rawtypes"})
      NamedList rsp = invokeCdcrAction(jetty, CdcrParams.CdcrAction.STATUS);
      @SuppressWarnings({"rawtypes"})
      NamedList status = (NamedList) rsp.get(CdcrParams.CdcrAction.STATUS.toLower());
      assertEquals(processState.toLower(), status.get(CdcrParams.ProcessState.getParam()));
      assertEquals(bufferState.toLower(), status.get(CdcrParams.BufferState.getParam()));
    }
  }

