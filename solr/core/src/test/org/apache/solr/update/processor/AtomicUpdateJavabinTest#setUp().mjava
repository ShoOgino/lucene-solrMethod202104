  @Before
  public void setUp() throws Exception {
    super.setUp();

    final SolrInputDocument committedDoc = sdoc(
            "id", COMMITTED_DOC_ID,
            "title_s", "title_1", "title_s", "title_2",
            "tv_mv_text", "text_1", "tv_mv_text", "text_2",
            "count_is", 1, "count_is", 2,
            "count_md", 1.0, "count_md", 2.0,
            "timestamps_mdt", DATE_1, "timestamps_mdt", DATE_2);
    final SolrInputDocument committedStrDoc = sdoc(
            "id", COMMITTED_DOC_STR_VALUES_ID,
            "title_s", "title_1", "title_s", "title_2",
            "tv_mv_text", "text_1", "tv_mv_text", "text_2",
            "count_is", "1", "count_is", "2",
            "count_md", "1.0", "count_md", "2.0",
            "timestamps_mdt", DATE_1_STR, "timestamps_mdt", DATE_2_STR);
    final UpdateRequest committedRequest = new UpdateRequest()
            .add(committedDoc)
            .add(committedStrDoc);
    committedRequest.commit(cluster.getSolrClient(), COLLECTION);

    // Upload a copy of id:1 that's uncommitted to test how atomic-updates modify values in the tlog
    // See SOLR-14971 for an example of why this case needs tested separately
    final SolrInputDocument uncommittedDoc = sdoc(
            "id", UNCOMMITTED_DOC_ID,
            "title_s", "title_1", "title_s", "title_2",
            "tv_mv_text", "text_1", "tv_mv_text", "text_2",
            "count_is", 1, "count_is", 2,
            "count_md", 1.0, "count_md", 2.0,
            "timestamps_mdt", DATE_1, "timestamps_mdt", DATE_2);
    final SolrInputDocument uncommittedStrDoc = sdoc(
            "id", UNCOMMITTED_DOC_STR_VALUES_ID,
            "title_s", "title_1", "title_s", "title_2",
            "tv_mv_text", "text_1", "tv_mv_text", "text_2",
            "count_is", "1", "count_is", "2",
            "count_md", "1.0", "count_md", "2.0",
            "timestamps_mdt", DATE_1_STR, "timestamps_mdt", DATE_2_STR);
    final UpdateRequest uncommittedRequest = new UpdateRequest()
            .add(uncommittedDoc)
            .add(uncommittedStrDoc);
    uncommittedRequest.process(cluster.getSolrClient(), COLLECTION);
  }

