  @Test
  public void testWsumPojo() throws Exception {
    WeightedSumMetric wsum = new WeightedSumMetric("avg", "count");
    assertEquals("wsum(avg, count, false)", wsum.getIdentifier());
    assertArrayEquals(new String[]{"avg", "count"}, wsum.getColumns());

    StreamFactory factory = new SolrDefaultStreamFactory();
    StreamExpressionParameter expr = wsum.toExpression(factory);
    assertTrue(expr instanceof StreamExpression);
    wsum = new WeightedSumMetric((StreamExpression) expr, factory);

    double expectedSum = 0d;
    for (int i = 0; i < counts.length; i++) {
      expectedSum += ((double) counts[i] / 100) * avg[i];
    }
    long expectedSumLong = Math.round(expectedSum);

    Number weightedSum = updateMetric(wsum);
    assertNotNull(weightedSum);
    assertTrue(weightedSum instanceof Double);
    assertTrue(weightedSum.doubleValue() == expectedSum);

    wsum = new WeightedSumMetric("avg", "count", true);
    assertEquals("wsum(avg, count, true)", wsum.getIdentifier());
    weightedSum = updateMetric(wsum);
    assertNotNull(weightedSum);
    assertTrue(weightedSum.longValue() == expectedSumLong);
  }

