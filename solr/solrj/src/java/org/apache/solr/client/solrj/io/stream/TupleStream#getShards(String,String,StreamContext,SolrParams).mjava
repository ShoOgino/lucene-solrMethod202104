  @SuppressWarnings({"unchecked"})
  public static List<String> getShards(String zkHost,
                                       String collection,
                                       StreamContext streamContext,
                                       SolrParams requestParams)
      throws IOException {

    List<String> shards;
    Map<String, List<String>> shardsMap = streamContext != null ? (Map<String, List<String>>)streamContext.get("shards") : null;
    if(shardsMap != null) {
      //Manual Sharding
      shards = shardsMap.get(collection);
      final Object core = streamContext.isLocal() ? streamContext.get("core") : null;
      if (core != null) {
        shards.removeIf(shardUrl -> !shardUrl.contains((CharSequence) core));
      }
    } else {
      shards = getReplicas(zkHost, collection, streamContext, requestParams).stream()
          .map(Replica::getCoreUrl).collect(Collectors.toList());
    }

    return shards;
  }

