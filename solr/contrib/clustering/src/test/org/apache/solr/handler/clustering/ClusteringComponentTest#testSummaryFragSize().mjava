  /**
   * We'll make two queries, one short summaries and another one with longer
   * summaries and will check that the results differ.
   */
  @Test
  public void testSummaryFragSize() throws Exception {
    String query = "+snippet:mine +" + QUERY_TESTSET_SAMPLE_DOCUMENTS;

    Consumer<ModifiableSolrParams> common = params -> {
      params.add(EngineParameters.PARAM_PREFER_QUERY_CONTEXT, "true");
      params.add(EngineParameters.PARAM_FIELDS, "title, snippet");
      params.add(EngineParameters.PARAM_CONTEXT_COUNT, Integer.toString(1));
    };

    List<Cluster<SolrDocument>> shortSummaries = clusters("echo", query,
        common.andThen(params -> {
          params.add(EngineParameters.PARAM_CONTEXT_SIZE, Integer.toString(30));
        }));

    List<Cluster<SolrDocument>> longSummaries = clusters("echo", query,
        common.andThen(params -> {
          params.add(EngineParameters.PARAM_CONTEXT_COUNT, Integer.toString(80));
        }));

    Assert.assertEquals(shortSummaries.size(), longSummaries.size());
    for (int i = 0; i < shortSummaries.size(); i++) {
      List<String> shortLabels = shortSummaries.get(i).getLabels();
      List<String> longLabels = longSummaries.get(i).getLabels();
      assertEquals(shortLabels.size(), longLabels.size());
      for (int j = 0; j < shortLabels.size(); j++) {
        MatcherAssert.assertThat("Shorter summary is longer than longer summary?",
            shortLabels.get(j).length(),
            Matchers.lessThanOrEqualTo(longLabels.get(j).length()));
      }
    }
  }

