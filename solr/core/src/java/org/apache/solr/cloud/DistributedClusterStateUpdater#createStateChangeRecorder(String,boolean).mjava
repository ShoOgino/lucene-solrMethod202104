  /**
   * Create a new instance of {@link StateChangeRecorder} for a given collection and a given intention (collection
   * creation vs. operations on an existing collection)
   */
  public StateChangeRecorder createStateChangeRecorder(String collectionName, boolean isCollectionCreation) {
    if (!useDistributedStateUpdate) {
      // Seeing this exception or any other of this kind here means there's a big bug in the code. No user input can cause this.
      throw new IllegalStateException("Not expecting to create instances of StateChangeRecorder when not using distributed state update");
    }
    return new StateChangeRecorder(collectionName, isCollectionCreation);
  }

