  @Test
  public void testFlagSerialization() {
    Random r = random();
    char[] flags = new char[r.nextInt(10)];
    for (int i = 0; i < flags.length; i++) {
      flags[i] = (char) r.nextInt(Character.MAX_VALUE);
    }

    String[] flagLines = {"FLAG long", "FLAG UTF-8", "FLAG num"};
    for (String flagLine : flagLines) {
      Dictionary.FlagParsingStrategy strategy = Dictionary.getFlagParsingStrategy(flagLine);
      StringBuilder serialized = new StringBuilder();
      for (char flag : flags) {
        strategy.appendFlag(flag, serialized);
      }

      char[] deserialized = strategy.parseFlags(serialized.toString());
      assertEquals(new String(flags), new String(deserialized));
    }
  }

