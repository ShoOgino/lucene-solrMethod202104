  public static MetricsConfiguration from(Document config) throws Exception {
    Node settings = getNode(config, "/config/settings");

    NodeList jqTemplates =
        (NodeList)(xpathFactory.newXPath()).evaluate("/config/jq-templates/template", config, XPathConstants.NODESET);
    Map<String,MetricsQueryTemplate> jqTemplatesMap =
        (jqTemplates != null && jqTemplates.getLength() > 0) ? loadJqTemplates(jqTemplates) : Collections.emptyMap();

    Node pingConfig = getNode(config, "/config/rules/ping");
    Node metricsConfig = getNode(config, "/config/rules/metrics");
    Node collectionsConfig = getNode(config, "/config/rules/collections");
    Node searchConfiguration = getNode(config, "/config/rules/search");

    return new MetricsConfiguration(
        settings == null ? PrometheusExporterSettings.builder().build() : PrometheusExporterSettings.from(settings),
        toMetricQueries(pingConfig, jqTemplatesMap),
        toMetricQueries(metricsConfig, jqTemplatesMap),
        toMetricQueries(collectionsConfig, jqTemplatesMap),
        toMetricQueries(searchConfiguration, jqTemplatesMap)
    );
  }

