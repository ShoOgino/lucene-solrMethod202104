  @Test
  public void testOnlyDocsInSearchResultsWillBeElevated() throws Exception {
    try {
      init("schema12.xml");
      assertU(adoc("id", "1", "title", "XXXX", "str_s1", "a"));
      assertU(adoc("id", "2", "title", "YYYY", "str_s1", "b"));
      assertU(adoc("id", "3", "title", "ZZZZ", "str_s1", "c"));

      assertU(adoc("id", "4", "title", "XXXX XXXX", "str_s1", "x"));
      assertU(adoc("id", "5", "title", "YYYY YYYY", "str_s1", "y"));
      assertU(adoc("id", "6", "title", "XXXX XXXX", "str_s1", "z"));
      assertU(adoc("id", "7", "title", "AAAA", "str_s1", "a"));

      assertU(commit());

      // default behaviour
      assertQ("", req(
              CommonParams.Q, "YYYY",
              CommonParams.QT, "/elevate",
              QueryElevationParams.ELEVATE_ONLY_DOCS_MATCHING_QUERY, "false",
              CommonParams.FL, "id, score, [elevated]"),
              "//*[@numFound='3']",
              "//result/doc[1]/str[@name='id'][.='1']",
              "//result/doc[2]/str[@name='id'][.='2']",
              "//result/doc[3]/str[@name='id'][.='5']",
              "//result/doc[1]/bool[@name='[elevated]'][.='true']",
              "//result/doc[2]/bool[@name='[elevated]'][.='true']",
              "//result/doc[3]/bool[@name='[elevated]'][.='false']"
      );

      // only docs that matches q
      assertQ("", req(
              CommonParams.Q, "YYYY",
              CommonParams.QT, "/elevate",
              QueryElevationParams.ELEVATE_ONLY_DOCS_MATCHING_QUERY, "true",
              CommonParams.FL, "id, score, [elevated]"),
              "//*[@numFound='2']",
              "//result/doc[1]/str[@name='id'][.='2']",
              "//result/doc[2]/str[@name='id'][.='5']",
              "//result/doc[1]/bool[@name='[elevated]'][.='true']",
              "//result/doc[2]/bool[@name='[elevated]'][.='false']"
      );



    } finally {
      delete();
    }
  }

