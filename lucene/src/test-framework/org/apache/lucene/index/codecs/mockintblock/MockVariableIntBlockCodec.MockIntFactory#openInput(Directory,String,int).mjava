    @Override
    public IntIndexInput openInput(Directory dir, String fileName, int readBufferSize) throws IOException {
      final IndexInput in = dir.openInput(fileName, readBufferSize);
      final int baseBlockSize = in.readInt();
      return new VariableIntBlockIndexInput(in) {

        @Override
        protected BlockReader getBlockReader(final IndexInput in, final int[] buffer) throws IOException {
          return new BlockReader() {
            public void seek(long pos) {}
            public int readBlock() throws IOException {
              buffer[0] = in.readVInt();
              final int count = buffer[0] <= 3 ? baseBlockSize-1 : 2*baseBlockSize-1;
              assert buffer.length >= count: "buffer.length=" + buffer.length + " count=" + count;
              for(int i=0;i<count;i++) {
                buffer[i+1] = in.readVInt();
              }
              return 1+count;
            }
          };
        }
      };
    }

