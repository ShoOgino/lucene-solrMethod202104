  void finishDocument() throws IOException {
    assert docWriter.writer.testPoint("StoredFieldsWriter.finishDocument start");

    initFieldsWriter();
    fill(docState.docID);
  
    if (fieldsWriter != null && numStoredFields > 0) {  
      fieldsWriter.startDocument(numStoredFields);
      for (int i = 0; i < numStoredFields; i++) {
        fieldsWriter.writeField(fieldNumbers[i], storedFields[i]);
      }
      lastDocID++;
    }
    
    reset();
    assert docWriter.writer.testPoint("StoredFieldsWriter.finishDocument end");
  }

