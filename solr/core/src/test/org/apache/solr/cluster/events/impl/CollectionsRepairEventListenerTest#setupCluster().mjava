  @BeforeClass
  public static void setupCluster() throws Exception {
    configureCluster(NUM_NODES)
        .addConfig("conf", TEST_PATH().resolve("configsets").resolve("cloud-minimal").resolve("conf"))
        .configure();
    PluginMeta plugin = new PluginMeta();
    plugin.klass = DefaultClusterEventProducer.class.getName();
    plugin.name = ClusterEventProducer.PLUGIN_NAME;
    V2Request req = new V2Request.Builder("/cluster/plugin")
        .withMethod(POST)
        .withPayload(Collections.singletonMap("add", plugin))
        .build();
    V2Response rsp = req.process(cluster.getSolrClient());
    assertNotNull(rsp);

    waitFor = 1 + random().nextInt(9);

    CoreContainer cc = cluster.getOpenOverseer().getCoreContainer();
    cc.getClusterEventProducer()
        .registerListener(eventsListener, ClusterEvent.EventType.values());
    repairListener = new CollectionsRepairWrapperListener(cc, waitFor);
    cc.getClusterEventProducer()
        .registerListener(repairListener, ClusterEvent.EventType.NODES_DOWN);
    repairListener.start();
  }

