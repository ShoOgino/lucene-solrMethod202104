  /**
   * Create a new solr client.
   * If createJetty was called, an http implementation will be created,
   * otherwise an embedded implementation will be created.
   * Subclasses should override for other options.
   */
  public SolrClient createNewSolrClient() {
    if (jetty != null) {
      try {
        // setup the client...
        String url = jetty.getBaseUrl().toString() + "/" + "collection1";
        HttpSolrClient client = new HttpSolrClient( url );
        client.setConnectionTimeout(DEFAULT_CONNECTION_TIMEOUT);
        return client;
      }
      catch( Exception ex ) {
        throw new RuntimeException( ex );
      }
    } else {
      return new EmbeddedSolrServer( h.getCoreContainer(), "collection1" ) {
        @Override
        public void close() {
          // do not close core container
        }
      };
    }
  }

