  Comparator getCachedComparator(String fieldname, int type, Locale locale, FieldComparatorSource factory) {
    Comparator comparator = null;
    switch (type) {
    case SortField.SCORE:
      comparator = comparatorScore(fieldname);
      break;
    case SortField.STRING:
      if (locale != null)
        comparator = comparatorStringLocale(fieldname, locale);
      else
        comparator = comparatorNatural(fieldname);
      break;
    case SortField.CUSTOM:
      if (factory instanceof MissingStringLastComparatorSource){
        comparator = comparatorMissingStringLast(fieldname);
      } else {
        // TODO: support other types such as random... is there a way to
        // support generically?  Perhaps just comparing Object
        comparator = comparatorNatural(fieldname);
        // throw new RuntimeException("Custom sort not supported factory is "+factory.getClass());
      }
      break;
    case SortField.DOC:
      // TODO: we can support this!
      throw new RuntimeException("Doc sort not supported");
    default:
      comparator = comparatorNatural(fieldname);
      break;
    }
    return comparator;
  }

