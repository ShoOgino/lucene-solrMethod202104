  /** 
   * Helper method for introspection testing 
   * @see #testPostFilterIntrospection
   */
  private DelegatingCollector parseAndBuildCollector(final String input, final SolrQueryRequest req) throws Exception {
    try {
      final SolrQueryResponse rsp = new SolrQueryResponse();
      SolrRequestInfo.setRequestInfo(new SolrRequestInfo(req,rsp));
      
      final Query q = QParser.getParser(input, "lucene", true, req).getQuery();
      assertTrue("Not a PostFilter: " + input, q instanceof PostFilter);
      return ((PostFilter)q).getFilterCollector(req.getSearcher());
    } finally {
      SolrRequestInfo.clearRequestInfo();
    }
  }

