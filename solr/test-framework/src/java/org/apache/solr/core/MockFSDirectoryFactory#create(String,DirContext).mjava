  @Override
  public Directory create(String path, DirContext dirContext) throws IOException {
    Directory dir = LuceneTestCase.newFSDirectory(new File(path).toPath());
    // we can't currently do this check because of how
    // Solr has to reboot a new Directory sometimes when replicating
    // or rolling back - the old directory is closed and the following
    // test assumes it can open an IndexWriter when that happens - we
    // have a new Directory for the same dir and still an open IW at 
    // this point
    
    Directory cdir = reduce(dir);
    cdir = reduce(cdir);
    cdir = reduce(cdir);
    
    if (cdir instanceof MockDirectoryWrapper) {
      ((MockDirectoryWrapper)cdir).setAssertNoUnrefencedFilesOnClose(false);
      ((MockDirectoryWrapper)cdir).setPreventDoubleWrite(false);
      ((MockDirectoryWrapper)cdir).setEnableVirusScanner(false);
    }
    return dir;
  }

