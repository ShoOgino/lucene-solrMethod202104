  /**
   * Take in a JSON command set and execute them. It tries to capture as many errors
   * as possible instead of failing at the first error it encounters
   * @param reader The input as a Reader
   * @return List of errors. If the List is empty then the operation was successful.
   */
  public List performOperations(Reader reader) throws Exception {
    List<CommandOperation> ops;
    try {
      ops = CommandOperation.parse(reader);
    } catch (Exception e) {
      String msg = "Error parsing schema operations ";
      log.warn(msg, e);
      return Collections.singletonList(singletonMap(CommandOperation.ERR_MSGS, msg + ":" + e.getMessage()));
    }
    List errs = CommandOperation.captureErrors(ops);
    if (!errs.isEmpty()) return errs;

    IndexSchema schema = req.getCore().getLatestSchema();
    if (schema instanceof ManagedIndexSchema && schema.isMutable()) {
      synchronized (schema.getSchemaUpdateLock()) {
        return doOperations(ops);
      }
    } else {
      return singletonList(singletonMap(CommandOperation.ERR_MSGS, "schema is not editable"));
    }
  }

