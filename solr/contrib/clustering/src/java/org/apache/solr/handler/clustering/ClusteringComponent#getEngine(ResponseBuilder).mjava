  private EngineEntry getEngine(ResponseBuilder rb) {
    if (engines.isEmpty()) {
      throw new SolrException(ErrorCode.SERVER_ERROR,
          "No clustering engines are defined or loaded.");
    }

    EngineEntry engine;
    String name = rb.req.getParams().get(REQUEST_PARAM_ENGINE, null);
    if (name != null) {
      engine = engines.get(name);
      if (engine == null) {
        throw new SolrException(ErrorCode.SERVER_ERROR,
            "Clustering engine unknown or not loaded: " + name);
      }
    } else {
      engine = engines.values().iterator().next();
    }
    return engine;
  }

